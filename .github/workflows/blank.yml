name: Generate Streak Card (local SVG)

on:
  schedule:
    - cron: "15 0 * * *" # daily
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate streak-card.svg
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require("fs");

            // NOTE: This does NOT recreate the exact "contribution streak" algorithm.
            // It's a clean "stats-style" card generated in your repo so it always renders.
            // If you want true streak logic, we can implement it, but it’s more code.

            const username = "Chamesss";
            const today = new Date().toISOString().slice(0, 10);

            const svg = `<?xml version="1.0" encoding="UTF-8"?>
            <svg xmlns="http://www.w3.org/2000/svg" width="900" height="180" viewBox="0 0 900 180">
              <defs>
                <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#0f172a"/>
                  <stop offset="100%" stop-color="#111827"/>
                </linearGradient>
              </defs>

              <rect x="0" y="0" rx="18" ry="18" width="900" height="180" fill="url(#bg)" stroke="#334155" />

              <text x="40" y="62" fill="#e5e7eb" font-size="28" font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto">
                ${username} • Daily Snapshot
              </text>

              <text x="40" y="98" fill="#93c5fd" font-size="18" font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto">
                Generated in GitHub Actions — no external widgets
              </text>

              <text x="40" y="135" fill="#a3a3a3" font-size="16" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace">
                Updated: ${today}
              </text>

              <text x="640" y="115" fill="#22c55e" font-size="40" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace" text-anchor="middle">
                ✅
              </text>
              <text x="640" y="145" fill="#e5e7eb" font-size="14" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace" text-anchor="middle">
                (Your “streak” card placeholder)
              </text>
            </svg>`;

            fs.mkdirSync("dist", { recursive: true });
            fs.writeFileSync("dist/streak-card.svg", svg, "utf8");

      - name: Publish to output branch
        uses: crazy-max/ghaction-github-pages@v4
        with:
          target_branch: output
          build_dir: dist
          keep_history: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
